<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KwikSend - Portefeuille</title>
  <meta name="description" content="Votre portefeuille KwikSend : consultez vos soldes, envoyez et recevez de l'argent en toute simplicitÃ©.">
  <meta name="theme-color" content="#ff7a00">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="manifest" href="site.webmanifest">
  <link rel="stylesheet" href="style.css">
  <style>
    /* âœ¨ Styles pour la modal amÃ©liorÃ©e */
    .action-choice {
      flex: 1;
      padding: 1rem;
      border: 2px solid #ddd;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }
    .action-choice:hover {
      border-color: #ffcc00;
      background: #fffbf5;
    }
    .action-choice input[type="radio"] {
      display: none;
    }
    .action-choice:has(input:checked) {
      border-color: #ff7a00;
      background: #fff8f2;
    }
    .methodBtn {
      padding: 1rem;
      border: 2px solid #ddd;
      border-radius: 10px;
      background: white;
      cursor: pointer;
      transition: all 0.2s;
      font-weight: 600;
      font-size: 0.95rem;
    }
    .methodBtn:hover {
      border-color: #ff7a00;
      background: #fff8f2;
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(255, 122, 0, 0.2);
    }
  </style>
</head>
<body>

<!-- ğŸ§­ Header -->
<header>
  <div class="container header-container">
    <div class="logo">Kwik<span>Send</span></div>
    <nav>
      <ul class="nav-links" id="nav-menu">
        <li><a href="dashboard.html">Accueil</a></li>
        <li><a href="portefeuille.html" class="active">Portefeuille</a></li>
        <li><a href="transfert.html">Transfert</a></li>
        <li><a href="kwiktransfert.html">KwikTransfert</a></li>
        <li><a href="releves.html">RelevÃ©s</a></li>
        <li><a href="profile.html">Compte</a></li>
        <li><a href="#" onclick="logout()">DÃ©connexion</a></li>
      </ul>
    </nav>
    <span class="burger" onclick="toggleMenu()">â˜°</span>
  </div>
</header>

<!-- ğŸ’¼ Portefeuille -->
<section class="wallet" style="padding:3rem 1rem;max-width:900px;margin:auto;">
  <h1 style="text-align:center;margin-bottom:2rem;">ğŸ’¼ Mon Portefeuille</h1>

  <!-- Solde -->
  <div class="balances" style="display:flex;justify-content:space-around;margin-bottom:2rem;">
    <div class="card" style="flex:1;margin:0 1rem;text-align:center;">
      <h3>EUR</h3>
      <p id="wallet-balance">0 â‚¬</p>
    </div>
    <div class="card" style="flex:1;margin:0 1rem;text-align:center;">
      <h3>FCFA</h3>
      <p id="wallet-balance-fcfa">0 FCFA</p>
    </div>
  </div>

  <!-- Carte virtuelle -->
  <div class="virtual-card">
    <div class="card-chip"></div>
    <div class="card-number">**** **** **** 1250</div>
    <div class="card-info">
      <span id="cardUser">KwikSend User</span>
      <span>12/28</span>
    </div>
  </div>

  <!-- Actions principales -->
  <form id="send-form" style="margin-top:2rem;display:flex;flex-wrap:wrap;gap:1rem;justify-content:center;">
    <input type="number" id="amount" placeholder="Entrez un montant" style="padding:0.6rem;border-radius:8px;border:1px solid #ccc;min-width:150px;" />
    <button type="submit">ğŸ’¸ Envoyer</button>
    <button type="button" onclick="openReceiveModal()">ğŸ“¥ Recevoir</button>
    <button type="button" onclick="openMoveFundsModal()">ğŸ” Alimenter / Retirer</button>
  </form>

  <!-- âœ¨ Modal Alimenter / Retirer (VERSION AMÃ‰LIORÃ‰E) -->
  <div id="moveFundsModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);align-items:center;justify-content:center;z-index:9999;">
    <div style="background:white;padding:2rem;border-radius:16px;max-width:500px;text-align:center;box-shadow:0 10px 40px rgba(0,0,0,0.3);">
      
      <h2 style="margin-bottom:0.5rem;">ğŸ” Alimenter / Retirer</h2>
      <p style="color:#666;margin-bottom:1.5rem;font-size:0.95rem;">Choisissez une action puis une mÃ©thode</p>
      
      <!-- Choix Action (Alimenter / Retirer) -->
      <div style="margin:1.5rem 0;display:flex;gap:1rem;justify-content:center;">
        <label class="action-choice">
          <input type="radio" name="moveAction" value="fund" checked>
          <div style="font-size:2rem;margin-bottom:0.5rem;">ğŸ“¥</div>
          <div style="font-weight:600;">Alimenter</div>
        </label>
        
        <label class="action-choice">
          <input type="radio" name="moveAction" value="withdraw">
          <div style="font-size:2rem;margin-bottom:0.5rem;">ğŸ“¤</div>
          <div style="font-weight:600;">Retirer</div>
        </label>
      </div>

      <!-- MÃ©thodes (redirection directe au clic) -->
      <p style="font-weight:600;margin-bottom:1rem;color:#333;">MÃ©thode :</p>
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:1rem;margin-bottom:1.5rem;">
        
        <button type="button" class="methodBtn" data-method="card">
          <div style="font-size:1.8rem;margin-bottom:0.3rem;">ğŸ’³</div>
          Carte bancaire
        </button>
        
        <button type="button" class="methodBtn" data-method="mobile">
          <div style="font-size:1.8rem;margin-bottom:0.3rem;">ğŸ“±</div>
          Mobile Money
        </button>
        
        <button type="button" class="methodBtn" data-method="iban">
          <div style="font-size:1.8rem;margin-bottom:0.3rem;">ğŸ¦</div>
          IBAN
        </button>
      </div>

      <button onclick="closeMoveFundsModal()" style="width:100%;padding:0.9rem;background:#f0f0f0;color:#333;border:none;border-radius:10px;cursor:pointer;font-weight:600;transition:0.2s;">
        âŒ Fermer
      </button>
    </div>
  </div>

  <!-- Modal Recevoir -->
  <div id="receiveModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);align-items:center;justify-content:center;">
    <div style="background:white;padding:2rem;border-radius:12px;max-width:400px;text-align:center;">
      <h2>ğŸ“¥ Recevoir de l'argent</h2>
      <canvas id="qrcode"></canvas>
      <p>Mon lien KwikSend :</p>
      <a href="https://kwiksend.com/user123" target="_blank">https://kwiksend.com/user123</a>
      <div style="margin-top:1rem;">
        <button onclick="shareWhatsApp()">ğŸ“² WhatsApp</button>
        <button onclick="shareEmail()">ğŸ“§ Email</button>
      </div>
      <button style="margin-top:1rem;" onclick="closeReceiveModal()">âŒ Fermer</button>
    </div>
  </div>

  <!-- Historique -->
  <section style="margin-top:3rem;">
    <h2>ğŸ“Š Historique des transactions</h2>
    <ul id="wallet-history" style="list-style:none;padding:0;margin-top:1rem;"></ul>
  </section>
</section>

<!-- ğŸ“ Footer -->
<footer>
  <p>Â© 2025 KwikSend. <span>Tous droits rÃ©servÃ©s.</span></p>
</footer>

<!-- ğŸ“² Scripts -->
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<script>
(function(){
  const BAL_KEY='ks_balance';
  const HIST_KEY='ks_history';
  const getBal = () => parseFloat(localStorage.getItem(BAL_KEY) || '0');
  const setBal = v => localStorage.setItem(BAL_KEY, String(v));
  const getHist = () => JSON.parse(localStorage.getItem(HIST_KEY) || '[]');
  const setHist = a => localStorage.setItem(HIST_KEY, JSON.stringify(a));

  if(localStorage.getItem(BAL_KEY)===null){ setBal(500); setHist([]); }

  const balanceEl = document.getElementById("wallet-balance");
  const balanceFcfaEl = document.getElementById("wallet-balance-fcfa");
  const historyEl = document.getElementById("wallet-history");
  const cardUser = document.getElementById("cardUser");

  const user = JSON.parse(localStorage.getItem("kwiksend_user") || "{}");
  if(user.name) cardUser.textContent = user.name;

  function renderWallet(){
    const bal = getBal();
    balanceEl.textContent = bal.toLocaleString('fr-FR') + " â‚¬";
    balanceFcfaEl.textContent = (bal*650).toLocaleString('fr-FR') + " FCFA";
    const hist = getHist();
    historyEl.innerHTML = hist.length 
      ? hist.map(tx => `<li>${tx.date} â€” ${tx.type} : ${tx.amount} â‚¬ <b>${tx.status||""}</b></li>`).join("")
      : "<li>Aucun mouvement</li>";
  }
  renderWallet();

  document.getElementById("send-form").addEventListener("submit", e=>{
    e.preventDefault();
    const amount = parseFloat(document.getElementById("amount").value);
    if(!(amount>0)) return alert("Montant invalide");
    if(amount>getBal()) return alert("Solde insuffisant");
    sessionStorage.setItem("ks_amount", String(amount));
    window.location.href="transfert.html";
  });

  // âœ… QR Modal
  window.openReceiveModal=()=>{document.getElementById("receiveModal").style.display="flex";QRCode.toCanvas(document.getElementById("qrcode"), "https://kwiksend.com/user123");}
  window.closeReceiveModal=()=>{document.getElementById("receiveModal").style.display="none";}
  window.shareWhatsApp=()=>{window.open("https://wa.me/?text=Voici mon lien KwikSend : https://kwiksend.com/user123");}
  window.shareEmail=()=>{window.location.href="mailto:?subject=Mon lien KwikSend&body=Voici mon lien KwikSend : https://kwiksend.com/user123";}

  // âœ¨ NOUVELLE LOGIQUE : Alimenter / Retirer avec redirection directe
  window.openMoveFundsModal=()=>{document.getElementById("moveFundsModal").style.display="flex";}
  window.closeMoveFundsModal=()=>{document.getElementById("moveFundsModal").style.display="none";}
  
  // ğŸ¯ Redirection immÃ©diate au clic sur une mÃ©thode
  document.querySelectorAll(".methodBtn").forEach(btn => {
    btn.addEventListener("click", () => {
      const action = document.querySelector("input[name='moveAction']:checked").value;
      const method = btn.dataset.method;
      
      // Redirection selon action + mÃ©thode
      if (action === "fund") {
        if (method === "card") window.location.href = "card-fund.html";
        else if (method === "mobile") window.location.href = "mobile-fund.html";
        else if (method === "iban") window.location.href = "iban-fund.html";
      } else {
        if (method === "card") window.location.href = "card-withdraw.html";
        else if (method === "mobile") window.location.href = "mobile-withdraw.html";
        else if (method === "iban") window.location.href = "iban-withdraw.html";
      }
    });
  });

  // âœ… DÃ©connexion
  window.logout=function(){localStorage.removeItem("kwiksend_user");window.location.href="index.html";}
})();
</script>
<script src="app.js"></script>
</body>
</html>
