<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>KwikSend - Portefeuille</title>
  <meta name="description" content="Votre portefeuille KwikSend : consultez vos soldes, envoyez et recevez de l’argent en toute simplicité.">
  <meta name="theme-color" content="#ff7a00">

  <!-- Favicon & icônes -->
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">

  <!-- Manifest PWA -->
  <link rel="manifest" href="site.webmanifest">

  <!-- Styles -->
  <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- 🧭 Header -->
<header>
  <div class="container header-container">
    <div class="logo">Kwik<span>Send</span></div>
    <nav>
      <ul class="nav-links">
        <li><a href="dashboard.html">Accueil</a></li>
        <li><a href="portefeuille.html" class="active">Portefeuille</a></li>
        <li><a href="transfert.html">Transfert</a></li>
        <li><a href="kwiktransfert.html">KwikTransfert</a></li>
        <li><a href="mobile.html">Mobile Money</a></li>
      </ul>
    </nav>
    <div class="header-actions">
      <button onclick="logout()" class="cta">Déconnexion</button>
    </div>
  </div>
</header>

<!-- 💼 Wallet -->
<section class="wallet" style="padding:3rem 1rem;max-width:900px;margin:auto;">
  <h1 style="text-align:center;margin-bottom:2rem;">💼 Mon Portefeuille</h1>

  <!-- Solde multi-devises -->
  <div class="balances" style="display:flex;justify-content:space-around;margin-bottom:2rem;">
    <div class="card" style="flex:1;margin:0 1rem;text-align:center;">
      <h3>EUR</h3>
      <p id="wallet-balance">0 €</p>
    </div>
    <div class="card" style="flex:1;margin:0 1rem;text-align:center;">
      <h3>FCFA</h3>
      <p id="wallet-balance-fcfa">0 FCFA</p>
    </div>
  </div>

  <!-- Carte virtuelle -->
  <div class="virtual-card">
    <div class="card-chip"></div>
    <div class="card-number">**** **** **** 1250</div>
    <div class="card-info">
      <span>KwikSend User</span>
      <span>12/28</span>
    </div>
  </div>

  <!-- Boutons actions -->
  <form id="send-form" style="margin-top:2rem;display:flex;flex-wrap:wrap;gap:1rem;justify-content:center;">
    <input type="number" id="amount" placeholder="Entrez un montant" style="padding:0.6rem;border-radius:8px;border:1px solid #ccc;min-width:150px;" />
    <button type="submit">💸 Envoyer</button>
    <button type="button" onclick="openReceiveModal()">📥 Recevoir</button>
    <button type="button" onclick="location.href='retrait.html'">🏦 Retrait IBAN</button>
    <button type="button" onclick="location.href='mobile.html'">📲 Mobile Money</button>
  </form>

  <!-- Modal Recevoir -->
  <div id="receiveModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);align-items:center;justify-content:center;">
    <div style="background:white;padding:2rem;border-radius:12px;max-width:400px;text-align:center;">
      <h2>📥 Recevoir de l’argent</h2>
      <canvas id="qrcode"></canvas>
      <p>Mon lien KwikSend :</p>
      <a href="https://kwiksend.com/user123" target="_blank">https://kwiksend.com/user123</a>
      <div style="margin-top:1rem;">
        <button onclick="shareWhatsApp()">📲 WhatsApp</button>
        <button onclick="shareEmail()">📧 Email</button>
      </div>
      <button style="margin-top:1rem;" onclick="closeReceiveModal()">❌ Fermer</button>
    </div>
  </div>

  <!-- Historique -->
  <section style="margin-top:3rem;">
    <h2>📊 Historique des transactions</h2>
    <ul id="wallet-history" style="list-style:none;padding:0;margin-top:1rem;"></ul>
  </section>
</section>

<!-- 📝 Footer -->
<footer>
  <p>© 2025 KwikSend. <span>Tous droits réservés.</span></p>
</footer>

<!-- 📲 Scripts -->
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<script>
(function(){
  const BAL_KEY='ks_balance';
  const HIST_KEY='ks_history';

  const getBal = () => parseFloat(localStorage.getItem(BAL_KEY) || '0');
  const setBal = v => localStorage.setItem(BAL_KEY, String(v));
  const getHist = () => JSON.parse(localStorage.getItem(HIST_KEY) || '[]');
  const setHist = a => localStorage.setItem(HIST_KEY, JSON.stringify(a));

  // init démo
  if(localStorage.getItem(BAL_KEY)===null){
    setBal(500);  // 👈 solde de départ démo
    setHist([]);
  }

  const balanceEl = document.getElementById("wallet-balance");
  const balanceFcfaEl = document.getElementById("wallet-balance-fcfa");
  const historyEl = document.getElementById("wallet-history");

  function renderWallet(){
    const bal = getBal();
    balanceEl.textContent = bal.toLocaleString('fr-FR') + " €";
    balanceFcfaEl.textContent = (bal*650).toLocaleString('fr-FR') + " FCFA";

    const hist = getHist();
    historyEl.innerHTML = hist.length 
      ? hist.map(tx => `<li>${tx.date} — ${tx.type} : ${tx.amount} € <b>${tx.status||""}</b></li>`).join("")
      : "<li>Aucun mouvement</li>";
  }
  renderWallet();

  // envoyer → enregistre montant + redirige vers transfert
  document.getElementById("send-form").addEventListener("submit", e=>{
    e.preventDefault();
    const amount = parseFloat(document.getElementById("amount").value);
    if(!(amount>0)) return alert("Montant invalide");
    if(amount>getBal()) return alert("Solde insuffisant");
    sessionStorage.setItem("ks_amount", String(amount));
    window.location.href="transfert.html";
  });

  // toast succès si retour
  const params = new URLSearchParams(location.search);
  if(params.get("ok")==="1"){
    alert("✅ Transfert simulé avec succès !");
  }

  // Modal QR
  window.openReceiveModal=function(){
    document.getElementById("receiveModal").style.display="flex";
    QRCode.toCanvas(document.getElementById("qrcode"), "https://kwiksend.com/user123");
  }
  window.closeReceiveModal=function(){
    document.getElementById("receiveModal").style.display="none";
  }
  window.shareWhatsApp=function(){
    window.open("https://wa.me/?text=Voici mon lien KwikSend : https://kwiksend.com/user123");
  }
  window.shareEmail=function(){
    window.location.href="mailto:?subject=Mon lien KwikSend&body=Voici mon lien KwikSend : https://kwiksend.com/user123";
  }

  // Déconnexion
  window.logout=function(){
    localStorage.removeItem("kwiksend_user");
    window.location.href="index.html";
  }
})();
</script>
</body>
</html>