<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KwikSend - Transfert Afrique ‚Üî Europe</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="manifest" href="site.webmanifest">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', -apple-system, sans-serif;
    }

    @keyframes bgGradient {
      0% { background: linear-gradient(135deg, #ffffff 0%, #fff8f2 100%); }
      33% { background: linear-gradient(135deg, #fff8f2 0%, #ffe7cc 100%); }
      66% { background: linear-gradient(135deg, #ffe7cc 0%, #f3e5f5 100%); }
      100% { background: linear-gradient(135deg, #f3e5f5 0%, #ffffff 100%); }
    }

    body {
      background: #ffffff;
      animation: bgGradient 12s ease-in-out infinite;
      color: #0A0F1C;
      min-height: 100vh;
    }

    /* üß≠ Header moderne */
    header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 1rem 0;
      border-bottom: 1px solid rgba(255, 138, 0, 0.1);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      position: sticky;
      top: 0;
      z-index: 999;
    }

    .header-container {
      width: 90%;
      max-width: 1200px;
      margin: auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-size: 1.5rem;
      font-weight: 900;
      background: linear-gradient(90deg, #FF8A00, #00B87C);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      cursor: pointer;
    }

    .nav-links {
      display: flex;
      gap: 2rem;
      list-style: none;
    }

    .nav-links a {
      color: #0A0F1C;
      text-decoration: none;
      font-weight: 500;
      transition: 0.2s;
    }

    .nav-links a:hover, .nav-links a.active {
      color: #FF8A00;
    }

    /* üíº Container principal */
    .transfer-container {
      max-width: 900px;
      margin: 3rem auto;
      padding: 0 1rem;
    }

    .transfer-title {
      text-align: center;
      font-size: 2rem;
      font-weight: 900;
      margin-bottom: 2rem;
      background: linear-gradient(90deg, #FF8A00, #00B87C, #8B5CF6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    /* üîÑ Toggle Direction - Design moderne */
    .direction-toggle {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      justify-content: center;
    }

    .toggle-btn {
      padding: 1rem 2.5rem;
      border: 2px solid #e0e0e0;
      background: white;
      color: #0A0F1C;
      border-radius: 20px;
      cursor: pointer;
      font-weight: 700;
      font-size: 1rem;
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }

    .toggle-btn:hover {
      border-color: #FF8A00;
      background: rgba(255, 138, 0, 0.05);
      transform: translateY(-2px);
    }

    .toggle-btn.active {
      background: linear-gradient(135deg, #FF8A00, #00B87C);
      color: white;
      border-color: #FF8A00;
      box-shadow: 0 8px 25px rgba(255, 138, 0, 0.3);
    }

    /* üìã Formulaire - Design moderne */
    .transfer-form {
      background: white;
      padding: 2rem;
      border-radius: 20px;
      box-shadow: 0 6px 20px rgba(10, 15, 28, 0.08);
      border: 1px solid rgba(255, 138, 0, 0.1);
      margin-bottom: 2rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: #0A0F1C;
      font-size: 0.95rem;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 1rem;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      font-size: 1rem;
      transition: all 0.3s;
      background: white;
      color: #0A0F1C;
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #FF8A00;
      box-shadow: 0 0 0 4px rgba(255, 138, 0, 0.1);
    }

    .input-with-currency {
      display: flex;
      gap: 0.5rem;
    }

    .input-with-currency input {
      flex: 1;
    }

    .input-with-currency select {
      width: 120px;
    }

    /* üì± Grille op√©rateurs - Design moderne */
    .operator-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .operator-btn {
      padding: 1.2rem;
      border: 2px solid #e0e0e0;
      background: white;
      border-radius: 16px;
      cursor: pointer;
      text-align: center;
      font-weight: 600;
      font-size: 0.9rem;
      transition: all 0.3s;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.6rem;
    }

    .operator-btn:hover {
      border-color: #FF8A00;
      background: rgba(255, 138, 0, 0.05);
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(255, 138, 0, 0.15);
    }

    .operator-btn.selected {
      background: linear-gradient(135deg, rgba(255, 138, 0, 0.15), rgba(0, 184, 124, 0.15));
      border: 2px solid #FF8A00;
      box-shadow: 0 8px 25px rgba(255, 138, 0, 0.25);
    }

    .operator-icon {
      font-size: 2rem;
    }

    /* üí≥ M√©thodes de paiement */
    .payment-methods {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .payment-btn {
      padding: 1.2rem;
      border: 2px solid #e0e0e0;
      background: white;
      color: #0A0F1C;
      border-radius: 16px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9rem;
      transition: all 0.3s;
      text-align: center;
    }

    .payment-btn:hover {
      border-color: #FF8A00;
      background: rgba(255, 138, 0, 0.05);
      transform: translateY(-2px);
    }

    .payment-btn.selected {
      background: linear-gradient(135deg, rgba(255, 138, 0, 0.15), rgba(0, 184, 124, 0.15));
      border: 2px solid #FF8A00;
      box-shadow: 0 6px 20px rgba(255, 138, 0, 0.2);
    }

    /* üìä Simulation Box - Design moderne */
    .simulation-box {
      background: linear-gradient(135deg, rgba(255, 138, 0, 0.08), rgba(0, 184, 124, 0.08));
      border: 2px solid rgba(255, 138, 0, 0.2);
      border-radius: 20px;
      padding: 2rem;
      margin-bottom: 2rem;
    }

    .simulation-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 0;
      border-bottom: 1px solid rgba(255, 138, 0, 0.1);
    }

    .simulation-row:last-child {
      border-bottom: none;
      padding-top: 1.5rem;
    }

    .simulation-label {
      color: #666;
      font-size: 1rem;
      font-weight: 500;
    }

    .simulation-value {
      font-weight: 700;
      color: #0A0F1C;
      font-size: 1.2rem;
    }

    .simulation-value.highlight {
      background: linear-gradient(90deg, #FF8A00, #00B87C);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-size: 1.8rem;
    }

    /* üéØ Bouton principal */
    .submit-btn {
      width: 100%;
      padding: 1.2rem;
      border: none;
      border-radius: 16px;
      background: linear-gradient(135deg, #00B87C, #00D48F);
      color: white;
      font-weight: 700;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }

    .submit-btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255,255,255,0.2);
      transform: translate(-50%, -50%);
      transition: width 0.5s, height 0.5s;
    }

    .submit-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 35px rgba(0, 184, 124, 0.4);
    }

    .submit-btn:hover::before {
      width: 300px;
      height: 300px;
    }

    .submit-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* üé® Section cach√©e */
    .hidden {
      display: none;
    }

    /* üì± Responsive */
    @media (max-width: 768px) {
      .nav-links {
        display: none;
      }

      .transfer-title {
        font-size: 1.5rem;
      }

      .direction-toggle {
        flex-direction: column;
      }

      .toggle-btn {
        width: 100%;
      }

      .operator-grid,
      .payment-methods {
        grid-template-columns: 1fr;
      }
    }

    /* Footer */
    footer {
      background: #0A0F1C;
      color: white;
      text-align: center;
      padding: 2rem;
      margin-top: 3rem;
    }
  </style>
</head>
<body>

<!-- üß≠ Header -->
<header>
  <div class="header-container">
    <div class="logo" onclick="window.location.href='dashboard.html'">KwikSend</div>
    <nav>
      <ul class="nav-links">
        <li><a href="dashboard.html">Accueil</a></li>
        <li><a href="portefeuille.html">Portefeuille</a></li>
        <li><a href="transfert.html" class="active">Transfert</a></li>
        <li><a href="kwiktransfert.html">KwikTransfert</a></li>
        <li><a href="releves.html">Relev√©s</a></li>
        <li><a href="profile.html">Compte</a></li>
        <li><a href="#" onclick="logout()">D√©connexion</a></li>
      </ul>
    </nav>
  </div>
</header>

<!-- üíº Container principal -->
<section class="transfer-container">
  <h1 class="transfer-title">üåç Transfert Afrique ‚Üî Europe</h1>

  <!-- üîÑ Toggle Direction -->
  <div class="direction-toggle">
    <button class="toggle-btn active" data-direction="send" onclick="switchDirection('send')">
      üí∏ Envoyer
    </button>
    <button class="toggle-btn" data-direction="receive" onclick="switchDirection('receive')">
      üì• Recevoir
    </button>
  </div>

  <!-- üì§ FORMULAIRE ENVOI -->
  <div id="sendForm" class="transfer-form">
    <!-- Destination -->
    <div class="form-group">
      <label>üåê Destination</label>
      <select id="destinationSend" onchange="updateDestinationFields()">
        <option value="">-- Choisissez une destination --</option>
        <option value="africa">üåç Afrique (Mobile Money)</option>
        <option value="europe">üá™üá∫ Europe (IBAN)</option>
      </select>
    </div>

    <!-- Champs dynamiques selon destination -->
    <div id="operatorSection" class="form-group hidden">
      <label>üì± Op√©rateur Mobile Money</label>
      <div class="operator-grid">
        <div class="operator-btn" onclick="selectOperator('Orange Money', this)">
          <span class="operator-icon">üü†</span>
          <span>Orange Money</span>
        </div>
        <div class="operator-btn" onclick="selectOperator('MTN Money', this)">
          <span class="operator-icon">üü°</span>
          <span>MTN Money</span>
        </div>
        <div class="operator-btn" onclick="selectOperator('Wave', this)">
          <span class="operator-icon">üîµ</span>
          <span>Wave</span>
        </div>
        <div class="operator-btn" onclick="selectOperator('Moov Money', this)">
          <span class="operator-icon">üü¢</span>
          <span>Moov Money</span>
        </div>
      </div>
    </div>

    <!-- Num√©ro / IBAN -->
    <div id="receiverSection" class="form-group hidden">
      <label id="receiverLabel">üìû Num√©ro du destinataire</label>
      <input type="text" id="receiverInput" placeholder="Exemple: +225 07 XX XX XX XX">
    </div>

    <!-- Montant -->
    <div class="form-group">
      <label>üí∞ Montant</label>
      <div class="input-with-currency">
        <input type="number" id="amountInput" placeholder="Exemple: 100" min="1" step="0.01">
        <select id="currencySelect" onchange="updateSimulation()">
          <option value="EUR">EUR (‚Ç¨)</option>
          <option value="FCFA">FCFA</option>
        </select>
      </div>
    </div>

    <!-- Moyen de paiement -->
    <div class="form-group">
      <label>üí≥ Moyen de paiement</label>
      <div class="payment-methods">
        <button type="button" class="payment-btn" onclick="selectPayment('wallet', this)">
          üíº Portefeuille
        </button>
        <button type="button" class="payment-btn" onclick="selectPayment('card', this)">
          üí≥ Carte
        </button>
        <button type="button" class="payment-btn" onclick="selectPayment('mobile', this)">
          üì± Mobile Money
        </button>
      </div>
    </div>

    <!-- Simulation -->
    <div class="simulation-box">
      <div class="simulation-row">
        <span class="simulation-label">Montant envoy√©</span>
        <span class="simulation-value" id="simAmount">0.00 EUR</span>
      </div>
      <div class="simulation-row">
        <span class="simulation-label">Frais de transfert</span>
        <span class="simulation-value" id="simFees">1.50 EUR</span>
      </div>
      <div class="simulation-row">
        <span class="simulation-label">Montant re√ßu</span>
        <span class="simulation-value highlight" id="simReceived">0.00 EUR</span>
      </div>
    </div>

    <!-- Bouton validation -->
    <button class="submit-btn" onclick="processSend()">
      ‚ú® Envoyer maintenant
    </button>
  </div>

  <!-- üì• FORMULAIRE RECEPTION (simplifi√©) -->
  <div id="receiveForm" class="transfer-form hidden">
    <div class="form-group">
      <label>üí∞ Montant √† recevoir</label>
      <div class="input-with-currency">
        <input type="number" id="receiveAmount" placeholder="Exemple: 50" min="1">
        <select>
          <option value="EUR">EUR (‚Ç¨)</option>
          <option value="FCFA">FCFA</option>
        </select>
      </div>
    </div>

    <button class="submit-btn" onclick="processReceive()">
      ‚úÖ G√©n√©rer le lien de paiement
    </button>
  </div>
</section>

<!-- Footer -->
<footer>
  <p>¬© 2025 KwikSend. Tous droits r√©serv√©s.</p>
</footer>

<!-- üìú Scripts -->
<script>
// ========================================
// üéÆ CONFIGURATION & √âTAT
// ========================================
const FEES = { fixed: 1.50, percent: 0.009 };
const CONVERSION_RATE = 650; // 1 EUR = 650 FCFA

let currentDirection = 'send';
let selectedOperator = null;
let selectedPayment = null;

// ========================================
// üîÑ TOGGLE DIRECTION (Envoyer / Recevoir)
// ========================================
function switchDirection(direction) {
  currentDirection = direction;
  
  // Update boutons
  document.querySelectorAll('.toggle-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.direction === direction);
  });
  
  // Toggle forms
  document.getElementById('sendForm').classList.toggle('hidden', direction !== 'send');
  document.getElementById('receiveForm').classList.toggle('hidden', direction !== 'receive');
}

// ========================================
// üåç GESTION DESTINATION
// ========================================
function updateDestinationFields() {
  const destination = document.getElementById('destinationSend').value;
  const operatorSection = document.getElementById('operatorSection');
  const receiverSection = document.getElementById('receiverSection');
  const receiverLabel = document.getElementById('receiverLabel');
  const receiverInput = document.getElementById('receiverInput');
  
  if (destination === 'africa') {
    operatorSection.classList.remove('hidden');
    receiverSection.classList.remove('hidden');
    receiverLabel.textContent = 'üìû Num√©ro Mobile Money';
    receiverInput.placeholder = 'Exemple: +225 07 XX XX XX XX';
  } else if (destination === 'europe') {
    operatorSection.classList.add('hidden');
    receiverSection.classList.remove('hidden');
    receiverLabel.textContent = 'üè¶ IBAN du destinataire';
    receiverInput.placeholder = 'Exemple: FR76 XXXX XXXX XXXX XXXX XXXX XXX';
    selectedOperator = null; // Reset operator
  } else {
    operatorSection.classList.add('hidden');
    receiverSection.classList.add('hidden');
  }
  
  updateSimulation();
}

// ========================================
// üì± S√âLECTION OP√âRATEUR
// ========================================
function selectOperator(operator, element) {
  selectedOperator = operator;
  
  // Update UI
  document.querySelectorAll('.operator-btn').forEach(btn => {
    btn.classList.remove('selected');
  });
  element.classList.add('selected');
}

// ========================================
// üí≥ S√âLECTION M√âTHODE PAIEMENT
// ========================================
function selectPayment(method, element) {
  selectedPayment = method;
  
  // Update UI
  document.querySelectorAll('.payment-btn').forEach(btn => {
    btn.classList.remove('selected');
  });
  element.classList.add('selected');
}

// ========================================
// üìä SIMULATION FRAIS
// ========================================
function updateSimulation() {
  const amountInput = document.getElementById('amountInput');
  const currency = document.getElementById('currencySelect').value;
  
  let amountEUR = parseFloat(amountInput.value) || 0;
  
  // Conversion si FCFA
  if (currency === 'FCFA') {
    amountEUR = amountEUR / CONVERSION_RATE;
  }
  
  // Calcul frais
  const fees = FEES.fixed + (amountEUR * FEES.percent);
  const received = Math.max(0, amountEUR - fees);
  
  // Affichage
  document.getElementById('simAmount').textContent = amountEUR.toFixed(2) + ' EUR';
  document.getElementById('simFees').textContent = fees.toFixed(2) + ' EUR';
  document.getElementById('simReceived').textContent = received.toFixed(2) + ' EUR';
}

// Listener sur changement montant
document.addEventListener('DOMContentLoaded', () => {
  const amountInput = document.getElementById('amountInput');
  if (amountInput) {
    amountInput.addEventListener('input', updateSimulation);
  }
});

// ========================================
// ‚úÖ TRAITEMENT ENVOI
// ========================================
function processSend() {
  const destination = document.getElementById('destinationSend').value;
  const receiver = document.getElementById('receiverInput').value.trim();
  const amount = parseFloat(document.getElementById('amountInput').value);
  const currency = document.getElementById('currencySelect').value;
  
  // Validations
  if (!destination) {
    return alert('‚ö†Ô∏è Veuillez choisir une destination');
  }
  
  if (destination === 'africa' && !selectedOperator) {
    return alert('‚ö†Ô∏è Veuillez s√©lectionner un op√©rateur Mobile Money');
  }
  
  if (!receiver) {
    return alert('‚ö†Ô∏è Veuillez entrer le num√©ro/IBAN du destinataire');
  }
  
  if (!amount || amount <= 0) {
    return alert('‚ö†Ô∏è Veuillez entrer un montant valide');
  }
  
  if (!selectedPayment) {
    return alert('‚ö†Ô∏è Veuillez choisir un moyen de paiement');
  }
  
  // Conversion en EUR si n√©cessaire
  let amountEUR = amount;
  if (currency === 'FCFA') {
    amountEUR = amount / CONVERSION_RATE;
  }
  
  // Calcul frais
  const fees = FEES.fixed + (amountEUR * FEES.percent);
  const received = amountEUR - fees;
  
  // Sauvegarde dans app.js (fonction globale)
  if (typeof saveDirectTransfer === 'function') {
    saveDirectTransfer({
      type: destination === 'africa' ? 'Envoi vers Afrique' : 'Envoi vers Europe',
      destination: destination,
      operator: selectedOperator,
      receiver: receiver,
      amount: amountEUR.toFixed(2),
      currency: 'EUR',
      fees: fees.toFixed(2),
      received: received.toFixed(2),
      status: 'En cours',
      method: selectedPayment
    });
  }
  
  // Mise √† jour solde portefeuille
  const BAL_KEY = 'ks_balance';
  let balance = parseFloat(localStorage.getItem(BAL_KEY) || '0');
  
  if (selectedPayment === 'wallet') {
    if (balance < amountEUR) {
      return alert('‚ùå Solde insuffisant dans votre portefeuille');
    }
    balance -= amountEUR;
    localStorage.setItem(BAL_KEY, String(balance));
  }
  
  // Notification succ√®s
  alert(`‚úÖ Transfert de ${amountEUR.toFixed(2)} EUR initi√© avec succ√®s !\n\nDestinataire: ${receiver}\nMontant re√ßu: ${received.toFixed(2)} EUR`);
  
  // Redirection vers portefeuille
  window.location.href = 'portefeuille.html?ok=1';
}

// ========================================
// üì• TRAITEMENT R√âCEPTION
// ========================================
function processReceive() {
  const amount = parseFloat(document.getElementById('receiveAmount').value);
  
  if (!amount || amount <= 0) {
    return alert('‚ö†Ô∏è Veuillez entrer un montant valide');
  }
  
  // Redirection vers page de r√©ception avec montant
  sessionStorage.setItem('receive_amount', amount);
  window.location.href = 'recevoir.html';
}

// ========================================
// üö™ D√âCONNEXION
// ========================================
function logout() {
  localStorage.removeItem("kwiksend_user");
  window.location.href = "connexion.html";
}
</script>

<!-- Appel scripts globaux -->
<script src="app.js"></script>

</body>
</html>
