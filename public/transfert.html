<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>KwikSend - Transferts Afrique â†” Europe</title>
  <meta name="description" content="Envoyez de lâ€™argent entre lâ€™Afrique et lâ€™Europe avec KwikSend, rapidement et en toute sÃ©curitÃ©.">
  <meta name="theme-color" content="#ff7a00">

  <!-- Favicon & icÃ´nes -->
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">

  <!-- Manifest PWA -->
  <link rel="manifest" href="site.webmanifest">

  <!-- Styles -->
  <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- ğŸ§­ Header -->
<header>
  <div class="container header-container">
    <div class="logo">Kwik<span>Send</span></div>
    <nav>
      <ul class="nav-links">
        <li><a href="index.html" data-i18n="nav.home">Accueil</a></li>
        <li><a href="index.html#fonctionnalites" data-i18n="nav.features">FonctionnalitÃ©s</a></li>
        <li><a href="index.html#avantages" data-i18n="nav.advantages">Avantages</a></li>
        <li><a href="portefeuille.html" data-i18n="nav.wallet">Portefeuille</a></li>
        <li><a href="connexion.html" class="cta-nav" data-i18n="nav.login">Connexion</a></li>
      </ul>
    </nav>
    <div class="header-actions">
      <select id="langSwitcher" onchange="switchLang(this.value)">
        <option value="fr">ğŸ‡«ğŸ‡· FR</option>
        <option value="en">ğŸ‡¬ğŸ‡§ EN</option>
      </select>
      <button id="darkToggle">ğŸŒ™</button>
    </div>
  </div>
</header>

<!-- ğŸŒ Transferts -->
<section class="hero" style="padding:2rem 1rem;">
  <div class="hero-content" style="max-width:600px;margin:auto;">
    <h1>ğŸŒ Transferts Afrique â†” Europe</h1>
    <p>Envoyez de lâ€™argent facilement et instantanÃ©ment.</p>

    <!-- Formulaire -->
    <form id="transferForm" style="display:flex;flex-direction:column;gap:1rem;margin-top:2rem;">
      <!-- Destination -->
      <label for="destination">Destination :</label>
      <select id="destination" required>
        <option value="afrique">ğŸŒ Afrique (Mobile Money)</option>
        <option value="europe">ğŸ‡ªğŸ‡º Europe (IBAN)</option>
      </select>

      <!-- Source -->
      <label for="source">Source des fonds :</label>
      <select id="source" required>
        <option value="wallet">ğŸ’¼ Portefeuille KwikSend</option>
        <option value="cb">ğŸ’³ Carte bancaire</option>
      </select>

      <!-- Champs dynamiques -->
      <div id="dynamicField"></div>

      <!-- Montant -->
      <label for="amount">Montant :</label>
      <input type="number" id="amount" placeholder="Ex: 100" required min="1">

      <!-- Bouton -->
      <button type="submit" class="cta">Envoyer</button>
    </form>
  </div>
</section>

<!-- ğŸ“ Footer -->
<footer>
  <p>Â© 2025 KwikSend. <span data-i18n="footer.rights">Tous droits rÃ©servÃ©s.</span></p>
</footer>

<!-- ğŸ“œ Scripts communs -->
<script src="script.js"></script>
<script src="translate.js"></script>
<script src="app.js"></script>

<!-- ğŸ“² Logique transfert -->
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js').catch(console.error);
  }

  const destinationEl = document.getElementById("destination");
  const dynamicField = document.getElementById("dynamicField");
  const form = document.getElementById("transferForm");

  // Adapter le champ selon la destination (IBAN ou Mobile Money)
  function updateDynamicField() {
    const dest = destinationEl.value;
    if (dest === "afrique") {
      dynamicField.innerHTML = `
        <label for="receiver">NumÃ©ro Mobile Money :</label>
        <input type="text" id="receiver" placeholder="Ex: 0700000000" required>
      `;
    } else {
      dynamicField.innerHTML = `
        <label for="receiver">IBAN destinataire :</label>
        <input type="text" id="receiver" placeholder="FR76 3000 6000 ..." required>
      `;
    }
  }
  destinationEl.addEventListener("change", updateDynamicField);
  updateDynamicField();

  // ğŸ”€ Adapter les sources selon la destination
  function updateSourceOptions() {
    const dest = document.getElementById("destination").value;
    const source = document.getElementById("source");

    source.innerHTML = ""; // reset options

    if (dest === "afrique") {
      source.innerHTML += `<option value="wallet">ğŸ’¼ Portefeuille KwikSend</option>`;
      source.innerHTML += `<option value="cb">ğŸ’³ Carte bancaire</option>`;
    } else {
      source.innerHTML += `<option value="wallet">ğŸ’¼ Portefeuille KwikSend</option>`;
      source.innerHTML += `<option value="mobile">ğŸ“² Mobile Money (OM, Waveâ€¦)</option>`;
    }
  }
  document.getElementById("destination").addEventListener("change", updateSourceOptions);
  updateSourceOptions();

  // ğŸš€ Gestion du formulaire de transfert
  form.addEventListener("submit", (e) => {
    e.preventDefault();
    const dest = destinationEl.value;
    const source = document.getElementById("source").value;
    const amount = parseFloat(document.getElementById("amount").value);
    const receiver = document.getElementById("receiver").value;

    if (isNaN(amount) || amount <= 0) {
      alert("âš ï¸ Veuillez saisir un montant valide.");
      return;
    }

    if (source === "wallet") {
      // DÃ©bit du portefeuille simulÃ©
      if (wallet.balance >= amount) {
        wallet.balance -= amount;
        wallet.history.unshift({
          type: "Envoi",
          amount: -amount,
          to: receiver,
          date: new Date().toLocaleDateString(),
          status: "validÃ©"
        });
        renderWallet();
        alert(`âœ… Transfert de ${amount} EUR vers ${receiver} (${dest}) effectuÃ© depuis votre portefeuille KwikSend.`);
      } else {
        alert("âŒ Solde insuffisant dans le portefeuille KwikSend.");
        return;
      }
    } else if (source === "cb") {
      alert(`ğŸ’³ Paiement de ${amount} EUR par carte bancaire vers ${receiver} (${dest}) simulÃ©.`);
    } else if (source === "mobile") {
      alert(`ğŸ“² Paiement de ${amount} EUR par Mobile Money vers ${receiver} (${dest}) simulÃ©.`);
    }

    // Redirection vers le portefeuille aprÃ¨s envoi
    window.location.href = "portefeuille.html";
  });
</script>
</body>
</html>