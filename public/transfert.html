<!DOCTYPE html>
<html lang="fr">
<head>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>KwikSend - Transferts Afrique â†” Europe</title>
  <meta name="description" content="TransfÃ©rez directement entre Afrique et Europe avec KwikSend.">
  <meta name="theme-color" content="#FF8A00">
  
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="manifest" href="site.webmanifest">
  <link rel="stylesheet" href="style.css">
  
  <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* ğŸ¨ STYLES SUPPLÃ‰MENTAIRES POUR TRANSFERT DIRECT              */
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    :root {
      --orange: #FF8A00;
      --green: #00B87C;
      --purple: #8B5CF6;
      --dark: #0A0F1C;
    }
    
    /* Toggle Direction */
    .direction-toggle {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      justify-content: center;
    }
    
    .toggle-btn {
      padding: 0.8rem 1.8rem;
      border: 2px solid #e0e0e0;
      background: white;
      color: var(--dark);
      border-radius: 20px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }
    
    .toggle-btn.active {
      background: linear-gradient(135deg, var(--orange), var(--green));
      color: white;
      border-color: var(--orange);
      box-shadow: 0 8px 25px rgba(255, 138, 0, 0.3);
    }
    
    /* Grille opÃ©rateurs */
    .operator-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 1rem;
      margin: 1rem 0;
    }
    
    .operator-btn {
      padding: 1rem;
      border: 2px solid #e0e0e0;
      background: white;
      border-radius: 12px;
      cursor: pointer;
      text-align: center;
      font-weight: 600;
      font-size: 0.85rem;
      transition: all 0.3s;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.6rem;
    }
    
    .operator-btn:hover {
      border-color: var(--orange);
      background: rgba(255, 138, 0, 0.05);
    }
    
    .operator-btn.selected {
      background: linear-gradient(135deg, rgba(255, 138, 0, 0.15), rgba(0, 184, 124, 0.15));
      border: 2px solid var(--orange);
      box-shadow: 0 6px 20px rgba(255, 138, 0, 0.2);
    }
    
    .operator-icon {
      font-size: 1.8rem;
    }
    
    /* Simulation Box */
    .simulation-box {
      background: linear-gradient(135deg, rgba(255, 138, 0, 0.08), rgba(0, 184, 124, 0.08));
      border: 2px solid rgba(255, 138, 0, 0.2);
      border-radius: 16px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }
    
    .simulation-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.8rem 0;
      border-bottom: 1px solid rgba(255, 138, 0, 0.1);
    }
    
    .simulation-row:last-child {
      border-bottom: none;
    }
    
    .simulation-label {
      color: #B0B3C2;
      font-size: 0.9rem;
      font-weight: 500;
    }
    
    .simulation-value {
      font-weight: 700;
      color: var(--dark);
      font-size: 1.1rem;
    }
    
    .simulation-value.highlight {
      background: linear-gradient(90deg, var(--orange), var(--green));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    /* Formulaires supplÃ©mentaires */
    .form-hidden {
      display: none;
    }
    
    .fees-detail {
      background: rgba(139, 92, 246, 0.05);
      border-left: 4px solid var(--purple);
      padding: 1rem;
      border-radius: 8px;
      margin: 1rem 0;
      font-size: 0.9rem;
      color: var(--dark);
    }
    
    .alert {
      padding: 1rem;
      border-radius: 12px;
      margin-bottom: 1.5rem;
      font-weight: 500;
      animation: slideDown 0.3s ease;
    }
    
    .alert-error {
      background: rgba(255, 0, 0, 0.1);
      border-left: 4px solid #FF0000;
      color: #C00000;
    }
    
    .alert-success {
      background: rgba(0, 184, 124, 0.1);
      border-left: 4px solid var(--green);
      color: var(--green);
    }
    
    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>

<!-- ğŸ§­ Header -->
<header>
  <div class="header-container">
    <div class="logo">Kwik<span>Send</span></div>
    <nav>
      <ul class="nav-links" id="nav-menu">
        <li><a href="dashboard.html">Accueil</a></li>
        <li><a href="portefeuille.html">Portefeuille</a></li>
        <li><a href="transfert.html">Transfert</a></li>
        <li><a href="kwiktransfert.html">KwikTransfert</a></li>
        <li><a href="releves.html">RelevÃ©s</a></li>
        <li><a href="profile.html">Compte</a></li>
        <li><a href="#" onclick="logout()">DÃ©connexion</a></li>
      </ul>
    </nav>
    <span class="burger" onclick="toggleMenu()">â˜°</span>
  </div>
</header>

<!-- ğŸŒ Transferts -->
<section class="hero" style="padding:2rem 1rem;">
  <div class="hero-content" style="max-width:650px;margin:auto;">
    <h1 style="font-size:2.2rem;margin-bottom:0.5rem;background:linear-gradient(135deg,#FF8A00,#00B87C,#8B5CF6);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">
      ğŸŒ Transfert Direct
    </h1>
    <p style="color:#B0B3C2;">Envoyez ou recevez instantanÃ©ment entre Afrique et Europe</p>

    <!-- ALERT -->
    <div id="alert" style="display:none;"></div>

    <!-- DIRECTION TOGGLE -->
    <div class="direction-toggle">
      <button class="toggle-btn active" data-direction="send" onclick="switchDirection('send')" type="button">
        ğŸ’¸ Envoyer
      </button>
      <button class="toggle-btn" data-direction="receive" onclick="switchDirection('receive')" type="button">
        ğŸ“¥ Recevoir
      </button>
    </div>

    <!-- FORM SEND (visible par dÃ©faut) -->
    <form id="formSend" class="form-section" style="display:block;">
      
      <!-- DESTINATION -->
      <div style="margin-bottom:1.5rem;">
        <label style="font-weight:600;display:flex;align-items:center;gap:0.5rem;">ğŸŒ Vers oÃ¹ ?</label>
        <select id="destinationSend" onchange="updateOperators()" style="padding:1rem;border:2px solid #e0e0e0;border-radius:12px;width:100%;font-size:1rem;">
          <option value="africa">ğŸŒ Afrique (Mobile Money)</option>
          <option value="europe">ğŸ‡ªğŸ‡º Europe (IBAN)</option>
        </select>
      </div>

      <!-- OPERATOR (Afrique uniquement) -->
      <div id="operatorSectionSend" style="display:none;margin-bottom:1.5rem;">
        <label style="font-weight:600;display:flex;align-items:center;gap:0.5rem;">ğŸ“± OpÃ©rateur</label>
        <div class="operator-grid" id="operatorGridSend">
          <!-- Dynamique -->
        </div>
      </div>

      <!-- RECEIVER -->
      <div style="margin-bottom:1.5rem;">
        <label id="receiverLabel" style="font-weight:600;display:flex;align-items:center;gap:0.5rem;">ğŸ“ NumÃ©ro ou IBAN</label>
        <input type="text" id="receiverSend" placeholder="Ex: 0700000000" required style="padding:1rem;border:2px solid #e0e0e0;border-radius:12px;width:100%;font-size:1rem;transition:all 0.3s;">
      </div>

      <!-- AMOUNT -->
      <div style="margin-bottom:1.5rem;">
        <label style="font-weight:600;display:flex;align-items:center;gap:0.5rem;">ğŸ’° Montant</label>
        <div style="display:flex;gap:0.5rem;">
          <input type="number" id="amountSend" placeholder="100" min="1" step="0.01" required style="flex:1;padding:1rem;border:2px solid #e0e0e0;border-radius:12px;font-size:1rem;">
          <select id="currencySend" onchange="updateSimulation()" style="padding:1rem;border:2px solid #e0e0e0;border-radius:12px;font-size:1rem;">
            <option value="EUR">EUR</option>
            <option value="FCFA">FCFA</option>
          </select>
        </div>
      </div>

      <!-- SIMULATION BOX -->
      <div class="simulation-box">
        <div class="simulation-row">
          <span class="simulation-label">Montant :</span>
          <span class="simulation-value" id="simAmount">0.00 EUR</span>
        </div>
        <div class="simulation-row">
          <span class="simulation-label">Frais :</span>
          <span class="simulation-value" id="simFees" style="color:#FF6B6B;">-1.50 EUR</span>
        </div>
        <div class="simulation-row">
          <span class="simulation-label">Montant reÃ§u :</span>
          <span class="simulation-value highlight" id="simReceived">98.50 EUR</span>
        </div>
      </div>

      <!-- FEES DETAIL -->
      <div class="fees-detail">
        âš¡ <strong>Frais fixes 1.5â‚¬</strong> + <strong>0.9%</strong> de commission. Transfert instantanÃ© (24h max).
      </div>

      <!-- BUTTON -->
      <button type="submit" style="width:100%;padding:1.2rem;background:linear-gradient(135deg,#FF8A00,#00B87C);color:white;border:none;border-radius:12px;font-weight:700;font-size:1.05rem;cursor:pointer;box-shadow:0 8px 25px rgba(255,138,0,0.3);transition:all 0.3s;">
        âœ¨ Envoyer maintenant
      </button>
    </form>

    <!-- FORM RECEIVE (cachÃ© par dÃ©faut) -->
    <form id="formReceive" class="form-section form-hidden" style="display:none;">
      
      <!-- SOURCE -->
      <div style="margin-bottom:1.5rem;">
        <label style="font-weight:600;display:flex;align-items:center;gap:0.5rem;">ğŸŒ D'oÃ¹ ?</label>
        <select id="sourceReceive" onchange="updateOperatorsReceive()" style="padding:1rem;border:2px solid #e0e0e0;border-radius:12px;width:100%;font-size:1rem;">
          <option value="africa">ğŸŒ Afrique (Mobile Money)</option>
          <option value="europe">ğŸ‡ªğŸ‡º Europe (IBAN)</option>
        </select>
      </div>

      <!-- OPERATOR RECEIVE -->
      <div id="operatorSectionReceive" style="display:none;margin-bottom:1.5rem;">
        <label style="font-weight:600;display:flex;align-items:center;gap:0.5rem;">ğŸ“± OpÃ©rateur de l'expÃ©diteur</label>
        <div class="operator-grid" id="operatorGridReceive">
          <!-- Dynamique -->
        </div>
      </div>

      <!-- SENDER -->
      <div style="margin-bottom:1.5rem;">
        <label id="senderLabel" style="font-weight:600;display:flex;align-items:center;gap:0.5rem;">ğŸ‘¤ NumÃ©ro ou IBAN de l'expÃ©diteur</label>
        <input type="text" id="senderReceive" placeholder="Ex: 0700000000" required style="padding:1rem;border:2px solid #e0e0e0;border-radius:12px;width:100%;font-size:1rem;">
      </div>

      <!-- AMOUNT EXPECTED -->
      <div style="margin-bottom:1.5rem;">
        <label style="font-weight:600;display:flex;align-items:center;gap:0.5rem;">ğŸ’° Montant attendu</label>
        <div style="display:flex;gap:0.5rem;">
          <input type="number" id="amountReceive" placeholder="100" min="1" step="0.01" required style="flex:1;padding:1rem;border:2px solid #e0e0e0;border-radius:12px;font-size:1rem;">
          <select id="currencyReceive" onchange="updateSimulationReceive()" style="padding:1rem;border:2px solid #e0e0e0;border-radius:12px;font-size:1rem;">
            <option value="EUR">EUR</option>
            <option value="FCFA">FCFA</option>
          </select>
        </div>
      </div>

      <!-- SIMULATION BOX RECEIVE -->
      <div class="simulation-box">
        <div class="simulation-row">
          <span class="simulation-label">Montant Ã  recevoir :</span>
          <span class="simulation-value highlight" id="simReceiveAmount">0.00 EUR</span>
        </div>
      </div>

      <!-- BUTTON -->
      <button type="submit" style="width:100%;padding:1.2rem;background:linear-gradient(135deg,#FF8A00,#00B87C);color:white;border:none;border-radius:12px;font-weight:700;font-size:1.05rem;cursor:pointer;box-shadow:0 8px 25px rgba(255,138,0,0.3);transition:all 0.3s;">
        âœ… Confirmer rÃ©ception
      </button>
    </form>

  </div>
</section>

<!-- ğŸ“ Footer -->
<footer>
  <p>Â© 2025 KwikSend. <span>Tous droits rÃ©servÃ©s.</span></p>
</footer>

<!-- ğŸ“œ Scripts communs -->
<script src="script.js"></script>
<script src="translate.js"></script>
<script src="app.js"></script>

<!-- ğŸ“² Logique transfert DIRECT -->
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js').catch(console.error);
  }

  // ======================================
  // ğŸ® CONFIGURATION
  // ======================================
  const OPERATORS = {
    africa: [
      { name: 'Orange Money', code: 'OM', emoji: 'ğŸŸ ' },
      { name: 'MTN Money', code: 'MTN', emoji: 'ğŸŸ¡' },
      { name: 'Wave', code: 'WAVE', emoji: 'ğŸ”µ' },
      { name: 'Moov Money', code: 'MOOV', emoji: 'ğŸŸ¢' }
    ]
  };

  const FEES = {
    fixed: 1.50,
    percent: 0.009
  };

  const CONVERSION_RATE = 650; // 1 EUR = 650 FCFA

  // ======================================
  // ğŸ¯ STATE
  // ======================================
  let currentDirection = 'send';
  let selectedOperator = null;
  let selectedOperatorReceive = null;

  // ======================================
  // ğŸ”„ TOGGLE DIRECTION
  // ======================================
  function switchDirection(direction) {
    currentDirection = direction;
    document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelector(`[data-direction="${direction}"]`).classList.add('active');

    if (direction === 'send') {
      document.getElementById('formSend').style.display = 'block';
      document.getElementById('formReceive').style.display = 'none';
    } else {
      document.getElementById('formSend').style.display = 'none';
      document.getElementById('formReceive').style.display = 'block';
    }
  }

  // ======================================
  // ğŸ“± UPDATE OPERATORS (SEND)
  // ======================================
  function updateOperators() {
    const dest = document.getElementById('destinationSend').value;
    const operatorSection = document.getElementById('operatorSectionSend');
    const grid = document.getElementById('operatorGridSend');

    if (dest === 'africa') {
      operatorSection.style.display = 'block';
      grid.innerHTML = OPERATORS.africa.map(op => `
        <button type="button" class="operator-btn" data-operator="${op.code}" onclick="selectOperator('${op.code}', 'send')">
          <div class="operator-icon">${op.emoji}</div>
          <div>${op.name}</div>
        </button>
      `).join('');
      document.getElementById('receiverLabel').textContent = 'ğŸ“ NumÃ©ro Mobile Money';
      document.getElementById('receiverSend').placeholder = 'Ex: 0700000000';
    } else {
      operatorSection.style.display = 'none';
      document.getElementById('receiverLabel').textContent = 'ğŸ¦ IBAN';
      document.getElementById('receiverSend').placeholder = 'Ex: FR7630006000...';
    }
  }

  // ======================================
  // ğŸ“± UPDATE OPERATORS (RECEIVE)
  // ======================================
  function updateOperatorsReceive() {
    const source = document.getElementById('sourceReceive').value;
    const operatorSection = document.getElementById('operatorSectionReceive');
    const grid = document.getElementById('operatorGridReceive');

    if (source === 'africa') {
      operatorSection.style.display = 'block';
      grid.innerHTML = OPERATORS.africa.map(op => `
        <button type="button" class="operator-btn" data-operator="${op.code}" onclick="selectOperator('${op.code}', 'receive')">
          <div class="operator-icon">${op.emoji}</div>
          <div>${op.name}</div>
        </button>
      `).join('');
      document.getElementById('senderLabel').textContent = 'ğŸ‘¤ NumÃ©ro Mobile Money';
      document.getElementById('senderReceive').placeholder = 'Ex: 0700000000';
    } else {
      operatorSection.style.display = 'none';
      document.getElementById('senderLabel').textContent = 'ğŸ¦ IBAN';
      document.getElementById('senderReceive').placeholder = 'Ex: FR7630006000...';
    }
  }

  // ======================================
  // âœ¨ SELECT OPERATOR
  // ======================================
  function selectOperator(code, type) {
    if (type === 'send') {
      selectedOperator = code;
      document.querySelectorAll('#operatorGridSend .operator-btn').forEach(btn => {
        btn.classList.toggle('selected', btn.dataset.operator === code);
      });
    } else {
      selectedOperatorReceive = code;
      document.querySelectorAll('#operatorGridReceive .operator-btn').forEach(btn => {
        btn.classList.toggle('selected', btn.dataset.operator === code);
      });
    }
    updateSimulation();
  }

  // ======================================
  // ğŸ’° SIMULATION (SEND)
  // ======================================
  function updateSimulation() {
    const amount = parseFloat(document.getElementById('amountSend').value) || 0;
    const currency = document.getElementById('currencySend').value;

    let amountEUR = amount;
    if (currency === 'FCFA') {
      amountEUR = amount / CONVERSION_RATE;
    }

    const fees = FEES.fixed + (amountEUR * FEES.percent);
    const received = amountEUR - fees;

    document.getElementById('simAmount').textContent = amount.toFixed(2) + ' ' + currency;
    document.getElementById('simFees').textContent = '-' + fees.toFixed(2) + ' EUR';
    document.getElementById('simReceived').textContent = received.toFixed(2) + ' EUR';
  }

  // ======================================
  // ğŸ’° SIMULATION (RECEIVE)
  // ======================================
  function updateSimulationReceive() {
    const amount = parseFloat(document.getElementById('amountReceive').value) || 0;
    const currency = document.getElementById('currencyReceive').value;

    let display = amount.toFixed(2) + ' ' + currency;
    document.getElementById('simReceiveAmount').textContent = display;
  }

  // ======================================
  // ğŸ“¤ SUBMIT SEND
  // ======================================
  document.getElementById('formSend').addEventListener('submit', async (e) => {
    e.preventDefault();

    const dest = document.getElementById('destinationSend').value;
    const receiver = document.getElementById('receiverSend').value.trim();
    const amount = parseFloat(document.getElementById('amountSend').value);
    const currency = document.getElementById('currencySend').value;

    // Validation
    if (!receiver) return showAlert('Veuillez entrer un numÃ©ro ou IBAN', 'error');
    if (dest === 'africa' && !selectedOperator) return showAlert('SÃ©lectionnez un opÃ©rateur', 'error');
    if (amount <= 0) return showAlert('Montant invalide', 'error');

    // Enregistrer dans l'historique
    saveDirectTransfer({
      type: 'Envoi Direct',
      destination: dest,
      operator: selectedOperator,
      receiver,
      amount: currency === 'EUR' ? amount : amount / CONVERSION_RATE,
      currency: 'EUR',
      status: 'En attente de validation'
    });

    showAlert(`âœ… Transfert lancÃ© ! Redirection en cours...`, 'success');
    
    setTimeout(() => {
      window.location.href = 'portefeuille.html?ok=1';
    }, 2000);
  });

  // ======================================
  // ğŸ“¥ SUBMIT RECEIVE
  // ======================================
  document.getElementById('formReceive').addEventListener('submit', async (e) => {
    e.preventDefault();

    const source = document.getElementById('sourceReceive').value;
    const sender = document.getElementById('senderReceive').value.trim();
    const amount = parseFloat(document.getElementById('amountReceive').value);
    const currency = document.getElementById('currencyReceive').value;

    // Validation
    if (!sender) return showAlert('Veuillez entrer un numÃ©ro ou IBAN', 'error');
    if (source === 'africa' && !selectedOperatorReceive) return showAlert('SÃ©lectionnez un opÃ©rateur', 'error');
    if (amount <= 0) return showAlert('Montant invalide', 'error');

    // Enregistrer
    saveDirectTransfer({
      type: 'RÃ©ception Direct',
      source,
      operator: selectedOperatorReceive,
      sender,
      amount: currency === 'EUR' ? amount : amount / CONVERSION_RATE,
      currency: 'EUR',
      status: 'En attente'
    });

    showAlert(`âœ… Transfert en attente ! Confirmez au guichet.`, 'success');
    
    setTimeout(() => {
      document.getElementById('formReceive').reset();
      switchDirection('send');
    }, 2000);
  });

  // ======================================
  // ğŸ”” SHOW ALERT
  // ======================================
  function showAlert(message, type) {
    const alertEl = document.getElementById('alert');
    alertEl.className = `alert alert-${type}`;
    alertEl.textContent = message;
    alertEl.style.display = 'block';

    if (type === 'success') {
      setTimeout(() => {
        alertEl.style.display = 'none';
      }, 4000);
    }
  }

  // ======================================
  // ğŸ’¾ SAVE TO HISTORY
  // ======================================
  function saveDirectTransfer(transfer) {
    const HIST_KEY = 'ks_direct_transfers';
    let history = JSON.parse(localStorage.getItem(HIST_KEY) || '[]');

    history.unshift({
      date: new Date().toLocaleString(),
      ...transfer
    });

    localStorage.setItem(HIST_KEY, JSON.stringify(history));
  }

  // ======================================
  // ğŸš€ INIT
  // ======================================
  document.addEventListener('DOMContentLoaded', () => {
    updateOperators();
    updateOperatorsReceive();
  });

  // ======================================
  // ğŸšª LOGOUT (GARDE L'ANCIENNE)
  // ======================================
  function logout(){
    localStorage.removeItem("kwiksend_user");
    window.location.href = "index.html";
  }
</script>
<!-- Appels scripts globaux -->
<script src="app.js"></script>
</body>
</html>
