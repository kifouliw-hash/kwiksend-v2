<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>KwikSend - Mobile Money & IBAN</title>
  <meta name="description" content="Rechargez ou retirez facilement avec KwikSend via Mobile Money (Orange Money, Wave, MTN, Moov) ou votre IBAN bancaire.">
  <meta name="theme-color" content="#ff7a00">

  <!-- Favicon & ic√¥nes -->
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">

  <!-- Manifest PWA -->
  <link rel="manifest" href="site.webmanifest">

  <!-- Styles -->
  <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- üß≠ Header -->
<header>
  <div class="container header-container">
    <div class="logo">Kwik<span>Send</span></div>
    <nav>
      <ul class="nav-links">
        <li><a href="dashboard.html">Accueil</a></li>
        <li><a href="portefeuille.html">Portefeuille</a></li>
        <li><a href="transfert.html">Transfert</a></li>
        <li><a href="kwiktransfert.html">KwikTransfert</a></li>
        <li><a href="mobile.html" class="active">Mobile Money</a></li>
      </ul>
    </nav>
    <div class="header-actions">
      <button class="cta" onclick="logout()">D√©connexion</button>
    </div>
  </div>
</header>

<!-- üì≤ Mobile Money & IBAN -->
<section class="hero" style="padding:2rem 1rem;">
  <div class="hero-content" style="max-width:650px;margin:auto;">
    <h1>üì≤ Mobile Money & IBAN</h1>
    <p>Alimentez ou retirez de l‚Äôargent via Mobile Money ou votre compte bancaire.</p>

    <!-- Formulaire -->
    <form id="mobileForm" style="display:flex;flex-direction:column;gap:1rem;margin-top:2rem;">
      <label>Action :</label>
      <select id="action" required>
        <option value="alimenter">‚ûï Alimenter</option>
        <option value="retirer">‚ûñ Retirer</option>
      </select>

      <label>M√©thode :</label>
      <select id="method" required>
        <option value="om">Orange Money</option>
        <option value="wave">Wave</option>
        <option value="mtn">MTN</option>
        <option value="moov">Moov</option>
        <option value="iban">IBAN bancaire</option>
      </select>

      <label>Montant :</label>
      <input type="number" id="amount" placeholder="Ex: 100" required min="1">

      <!-- Champ dynamique -->
      <div id="detailsField"></div>

      <button type="submit" class="cta">Valider</button>
    </form>
  </div>
</section>

<!-- üìù Footer -->
<footer>
  <p>¬© 2025 KwikSend. <span>Tous droits r√©serv√©s.</span></p>
</footer>

<!-- üìú Scripts communs -->
<script src="script.js"></script>
<script src="translate.js"></script>
<script src="app.js"></script>

<!-- üì≤ Logique Mobile Money -->
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js').catch(console.error);
  }

  const actionEl = document.getElementById("action");
  const methodEl = document.getElementById("method");
  const detailsField = document.getElementById("detailsField");
  const form = document.getElementById("mobileForm");

  // --- Affichage champ selon m√©thode
  function updateDetailsField() {
    const method = methodEl.value;
    if (method === "iban") {
      detailsField.innerHTML = `
        <label>IBAN :</label>
        <input type="text" id="detailInput" placeholder="FR76 3000 6000 ..." required>
      `;
    } else {
      detailsField.innerHTML = `
        <label>Num√©ro Mobile Money :</label>
        <input type="text" id="detailInput" placeholder="0700000000" required>
      `;
    }
  }
  methodEl.addEventListener("change", updateDetailsField);
  updateDetailsField();

  // --- Simulation alimentation/retrait
  form.addEventListener("submit", (e) => {
    e.preventDefault();
    const action = actionEl.value;
    const method = methodEl.value;
    const amount = parseFloat(document.getElementById("amount").value);
    const detail = document.getElementById("detailInput").value;

    if (isNaN(amount) || amount <= 0) {
      alert("‚ö†Ô∏è Veuillez entrer un montant valide.");
      return;
    }

    // localStorage keys
    const BAL_KEY = 'ks_balance';
    const HIST_KEY = 'ks_history';
    let balance = parseFloat(localStorage.getItem(BAL_KEY) || '0');
    let history = JSON.parse(localStorage.getItem(HIST_KEY) || '[]');

    if (action === "alimenter") {
      balance += amount;
      history.unshift({
        date: new Date().toLocaleString(),
        type: "Alimentation",
        amount: +amount,
        from: method.toUpperCase(),
        status: "valid√©"
      });
      alert(`‚úÖ Votre portefeuille a √©t√© aliment√© de ${amount} EUR via ${method.toUpperCase()}.`);
    } else {
      if (amount > balance) {
        alert("‚ùå Solde insuffisant pour effectuer ce retrait.");
        return;
      }
      balance -= amount;
      history.unshift({
        date: new Date().toLocaleString(),
        type: "Retrait",
        amount: -amount,
        to: method.toUpperCase(),
        status: "attente"
      });
      alert(`‚è≥ Retrait de ${amount} EUR via ${method.toUpperCase()} en cours de traitement.`);
    }

    // Sauvegarde
    localStorage.setItem(BAL_KEY, balance);
    localStorage.setItem(HIST_KEY, JSON.stringify(history));

    // Redirection portefeuille
    window.location.href = "portefeuille.html?ok=1";
  });

  // --- D√©connexion
  function logout(){
    localStorage.removeItem("kwiksend_user");
    window.location.href = "index.html";
  }
</script>
</body>
</html>